import{_ as t,r as i,o as p,c,a as s,b as l,d as a,e as n}from"./app.e5cd9b05.js";const o={},u=a(`<h2 id="\u66F4\u65B0-ubuntu-\u8F6F\u4EF6\u6E90" tabindex="-1"><a class="header-anchor" href="#\u66F4\u65B0-ubuntu-\u8F6F\u4EF6\u6E90" aria-hidden="true">#</a> \u66F4\u65B0 ubuntu \u8F6F\u4EF6\u6E90</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> upgrade -y
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="\u5B89\u88C5\u8F6F\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5\u8F6F\u4EF6" aria-hidden="true">#</a> \u5B89\u88C5\u8F6F\u4EF6</h2><h3 id="\u5B89\u88C5-node" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5-node" aria-hidden="true">#</a> \u5B89\u88C5 node</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nodejs -y
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">npm</span> -y
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="npm-\u8BBE\u7F6E\u6DD8\u5B9D\u6E90" tabindex="-1"><a class="header-anchor" href="#npm-\u8BBE\u7F6E\u6DD8\u5B9D\u6E90" aria-hidden="true">#</a> npm \u8BBE\u7F6E\u6DD8\u5B9D\u6E90</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">npm</span> config <span class="token builtin class-name">set</span> registry https://registry.npm.taobao.org
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="\u5168\u5C40\u5B89\u88C5-pm2\u3001n" tabindex="-1"><a class="header-anchor" href="#\u5168\u5C40\u5B89\u88C5-pm2\u3001n" aria-hidden="true">#</a> \u5168\u5C40\u5B89\u88C5 pm2\u3001n</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">npm</span> i pm2 n -g
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="\u66F4\u65B0-node-\u7248\u672C\u4E3A\u6700\u65B0\u7684-lts" tabindex="-1"><a class="header-anchor" href="#\u66F4\u65B0-node-\u7248\u672C\u4E3A\u6700\u65B0\u7684-lts" aria-hidden="true">#</a> \u66F4\u65B0 node \u7248\u672C\u4E3A\u6700\u65B0\u7684 lts</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> n lts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u5B89\u88C5-nginx" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5-nginx" aria-hidden="true">#</a> \u5B89\u88C5 nginx</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nginx -y
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u5B89\u88C5-mysql" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5-mysql" aria-hidden="true">#</a> \u5B89\u88C5 mysql</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> mysql-server -y
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="\u68C0\u67E5-mysql-\u662F\u5426\u6B63\u5E38\u542F\u52A8" tabindex="-1"><a class="header-anchor" href="#\u68C0\u67E5-mysql-\u662F\u5426\u6B63\u5E38\u542F\u52A8" aria-hidden="true">#</a> \u68C0\u67E5 MySQL \u662F\u5426\u6B63\u5E38\u542F\u52A8</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>systemctl status mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="\u521D\u59CB\u5316" tabindex="-1"><a class="header-anchor" href="#\u521D\u59CB\u5316" aria-hidden="true">#</a> \u521D\u59CB\u5316</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> mysql_secure_installation
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="\u914D\u7F6E-ssh-deploy" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E-ssh-deploy" aria-hidden="true">#</a> \u914D\u7F6E ssh deploy</h2><p>\u5728\u670D\u52A1\u5668\u751F\u6210\u5BC6\u94A5</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>ssh-keygen -m PEM -t rsa -b <span class="token number">4096</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5C06\u516C\u94A5\u4FDD\u5B58\u5230<code>authorized_keys</code>\u6587\u4EF6\u4E2D</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">cp</span> ~/.ssh/id_rsa.pub ~/.ssh/authorized_keys
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="\u8BBE\u7F6E-secrets" tabindex="-1"><a class="header-anchor" href="#\u8BBE\u7F6E-secrets" aria-hidden="true">#</a> \u8BBE\u7F6E Secrets</h2><p>\u5728\u670D\u52A1\u5668\u521B\u5EFA\u5B58\u653E\u9879\u76EE\u7684\u6587\u4EF6\u5939\uFF0C\u7ED9\u6587\u4EF6\u5939\u6240\u6709\u6743\u9650</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">chown</span> -R \u7528\u6237\u540D \u6587\u4EF6\u5939\u540D\u79F0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol><li><code>SSH_PRIVATE_KEY</code>\uFF1A\u670D\u52A1\u5668\u79C1\u94A5</li><li><code>REMOTE_HOST</code>\uFF1A\u670D\u52A1\u5668 ip \u6216\u57DF\u540D</li><li><code>REMOTE_USER</code>\uFF1A\u670D\u52A1\u5668\u767B\u5F55\u7528\u6237\u540D</li><li><code>REMOTE_PASSWORD</code>\uFF1A\u670D\u52A1\u5668\u767B\u5F55\u5BC6\u7801</li><li><code>TARGET</code>\uFF1A\u6253\u5305\u540E\u7684\u6587\u4EF6\u5B58\u653E\u5728\u670D\u52A1\u5668\u54EA\u4E2A\u76EE\u5F55\u4E0B</li></ol><h2 id="\u7F16\u5199-workflow-\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u7F16\u5199-workflow-\u6587\u4EF6" aria-hidden="true">#</a> \u7F16\u5199 workflow \u6587\u4EF6</h2><p>\u521B\u5EFA<code>.github/workflows/deploy.yml</code>\u6587\u4EF6\uFF0C\u914D\u7F6E\u5982\u4E0B\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy

<span class="token comment"># \u89E6\u53D1\u6761\u4EF6\uFF1A\u5728 push \u5230 main \u5206\u652F\u540E</span>
<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> main

<span class="token comment"># \u4EFB\u52A1</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build-and-deploy</span><span class="token punctuation">:</span>
    <span class="token comment"># \u670D\u52A1\u5668\u73AF\u5883\uFF1A\u6700\u65B0\u7248 Ubuntu</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
      <span class="token key atrule">matrix</span><span class="token punctuation">:</span>
        <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>16.x<span class="token punctuation">]</span>

    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Use Node.js $<span class="token punctuation">{</span><span class="token punctuation">{</span> matrix.node<span class="token punctuation">-</span>version <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> matrix.node<span class="token punctuation">-</span>version <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">cache</span><span class="token punctuation">:</span> <span class="token string">&#39;npm&#39;</span>

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> build
        <span class="token key atrule">run</span><span class="token punctuation">:</span> npm i <span class="token important">&amp;&amp;</span> npm run build

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy To Server
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> easingthemes/ssh<span class="token punctuation">-</span>deploy@main
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
          <span class="token key atrule">SSH_PRIVATE_KEY</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.SSH_PRIVATE_KEY <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">ARGS</span><span class="token punctuation">:</span> <span class="token string">&#39;-rltgoDzvO --delete&#39;</span>
          <span class="token key atrule">SOURCE</span><span class="token punctuation">:</span> <span class="token string">&#39;dist/&#39;</span>
          <span class="token key atrule">REMOTE_HOST</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.REMOTE_HOST <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">REMOTE_USER</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.REMOTE_USER <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">TARGET</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.TARGET <span class="token punctuation">}</span><span class="token punctuation">}</span>

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy file via ssh password
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> appleboy/scp<span class="token punctuation">-</span>action@master
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">host</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.REMOTE_HOST <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">username</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.REMOTE_USER <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">password</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.REMOTE_PASSWORD <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">port</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.REMOTE_PORT <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">source</span><span class="token punctuation">:</span> <span class="token string">&#39;package.json&#39;</span>
          <span class="token key atrule">target</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.TARGET <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">overwrite</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> executing remote ssh commands using password
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> appleboy/ssh<span class="token punctuation">-</span>action@master
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">host</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.REMOTE_HOST <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">username</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.REMOTE_USER <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">password</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.REMOTE_PASSWORD <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">port</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.REMOTE_PORT <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">script</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
            rm -rf /workspace/mall/public
            cp /workspace/.env /workspace/mall
            cp -r /workspace/public /workspace/mall/apps/
            cd /workspace/mall
            npm i
            pm2 delete mangement
            pm2 delete web
            pm2 start /workspace/mall/apps/mangement/main.js --name=mangement
            pm2 start /workspace/mall/apps/web/main.js --name=web
            pm2 save</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u914D\u7F6E-nginx" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E-nginx" aria-hidden="true">#</a> \u914D\u7F6E nginx</h2>`,34),d=n("\u53BB"),r={href:"https://www.digitalocean.com/community/tools/nginx?domains.0.php.php=false&domains.0.reverseProxy.reverseProxy=true&domains.0.routing.root=false&global.app.lang=zhCN",target:"_blank",rel:"noopener noreferrer"},k=n("NGINXCONFIG"),v=n(" \u914D\u7F6E nginx"),m=a(`<p>\u5728 vscode \u4E2D\u5B89\u88C5<code>remote-ssh</code>\u63D2\u4EF6\uFF0C\u8FDE\u63A5\u670D\u52A1\u5668</p><p>\u7ED9<code>/etc/nginx</code>\u6587\u4EF6\u5939\u6743\u9650</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">chown</span> -R \u7528\u6237\u540D /etc/nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5C06\u914D\u7F6E\u597D\u7684 nginx \u6587\u4EF6\u4E0B\u8F7D\u4E0B\u6765\uFF0C\u4E0A\u4F20\u5230\u670D\u52A1\u5668<code>/etc/nginx</code></p><p>\u521B\u5EFA\u5F53\u524D NGINX \u914D\u7F6E\u7684<strong>\u5907\u4EFD</strong>\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">tar</span> -czvf nginx_<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">&#39;%F_%H-%M-%S&#39;</span><span class="token variable">)</span></span>.tar.gz nginx.conf sites-available/ sites-enabled/ nginxconfig.io/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4F7F\u7528 tar<strong>\u89E3\u538B</strong>\u65B0\u7684\u538B\u7F29\u914D\u7F6E\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">tar</span> -xzvf \u914D\u7F6E\u6587\u4EF6\u5939\u540D\u79F0 <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">chmod</span> 0644
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5982\u679C\u4F7F\u7528 https\uFF0C\u5219\u5728<code>/etc/nginx</code>\u76EE\u5F55\u4E0B\u751F\u6210<code>dhparam.pem</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> openssl dhparam -out dhparam.pem <span class="token number">2048</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u91CD\u542F nginx \u4F7F\u914D\u7F6E\u751F\u6548\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> nginx -s stop
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> nginx -c /etc/nginx/nginx.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> nginx -s reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,14);function b(h,g){const e=i("ExternalLinkIcon");return p(),c("div",null,[u,s("p",null,[d,s("a",r,[k,l(e)]),v]),m])}var f=t(o,[["render",b],["__file","20220524.html.vue"]]);export{f as default};
